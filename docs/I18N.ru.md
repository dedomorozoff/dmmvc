# Интернационализация (i18n)

DMMVC включает встроенную поддержку интернационализации, позволяя вашему приложению поддерживать несколько языков.

## Возможности

- Поддержка нескольких языков (английский, русский)
- Автоматическое определение локали из:
  - Параметров запроса (`?lang=ru`)
  - Cookies
  - Заголовка Accept-Language
- Интеграция с шаблонами
- API для переключения языка
- Легко добавлять новые языки

## Конфигурация

### Файлы переводов

Файлы переводов хранятся в директории `locales/` в формате JSON:

```
locales/
├── en.json  # Английские переводы
└── ru.json  # Русские переводы
```

### Формат файла переводов

```json
{
  "key": "Текст перевода",
  "greeting": "Привет, %s!",
  "app.name": "Моё приложение"
}
```

## Использование

### В Go обработчиках

```go
import "dmmvc/internal/i18n"

func MyHandler(c *gin.Context) {
    // Получить переведенную строку
    message := i18n.T(c, "greeting", "Иван")
    
    // Получить текущую локаль
    locale := i18n.GetLocale(c)
    
    c.JSON(200, gin.H{
        "message": message,
        "locale": locale,
    })
}
```

### В шаблонах

Шаблоны автоматически имеют доступ к функциям перевода:

```html
<h1>{{t "app.name"}}</h1>
<p>{{t "greeting" .username}}</p>
<p>Текущий язык: {{locale}}</p>
```

### Изменение языка

#### Через параметр запроса

```
http://localhost:8080/?lang=ru
```

#### Через API

```javascript
fetch('/api/locale', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({ locale: 'ru' })
});
```

#### Через переключатель языка

UI включает автоматический переключатель языка, который появляется в заголовке.

## API эндпоинты

### Установить локаль

**POST** `/api/locale`

Запрос:
```json
{
  "locale": "ru"
}
```

Ответ:
```json
{
  "success": true,
  "locale": "ru"
}
```

### Получить доступные локали

**GET** `/api/locales`

Ответ:
```json
{
  "success": true,
  "data": {
    "locales": ["en", "ru"],
    "current": "ru"
  }
}
```

## Добавление новых языков

1. Создайте новый файл перевода в директории `locales/`:

```bash
# Создать испанские переводы
touch locales/es.json
```

2. Добавьте переводы:

```json
{
  "app.name": "Mi Aplicación",
  "greeting": "¡Hola, %s!"
}
```

3. Обновите `internal/i18n/i18n.go` для включения новой локали:

```go
const (
    LocaleEN Locale = "en"
    LocaleRU Locale = "ru"
    LocaleES Locale = "es"  // Добавить новую локаль
)
```

4. Обновите метод `LoadTranslations`:

```go
locales := []Locale{LocaleEN, LocaleRU, LocaleES}
```

5. Обновите middleware и обработчики для поддержки новой локали.

## Лучшие практики

### Ключи переводов

Используйте иерархические ключи для лучшей организации:

```json
{
  "auth.login": "Вход",
  "auth.logout": "Выход",
  "auth.register": "Регистрация",
  "user.profile": "Профиль",
  "user.settings": "Настройки"
}
```

### Плейсхолдеры

Используйте `%s`, `%d` и т.д. для динамических значений:

```json
{
  "welcome": "Добро пожаловать, %s!",
  "items_count": "У вас %d элементов"
}
```

Использование:
```go
i18n.T(c, "welcome", username)
i18n.T(c, "items_count", count)
```

### Fallback

Если ключ перевода не найден:
1. Система пытается использовать локаль по умолчанию (английский)
2. Если все еще не найден, возвращает сам ключ

### Производительность

- Переводы загружаются один раз при запуске
- Кешируются в памяти для быстрого доступа
- Потокобезопасны с использованием RWMutex

## Пример

### Контроллер

```go
func ProfilePage(c *gin.Context) {
    user := getCurrentUser(c)
    
    c.HTML(200, "pages/profile.html", gin.H{
        "title": i18n.T(c, "profile.title"),
        "user": user,
    })
}
```

### Шаблон

```html
{{define "pages/profile.html"}}
{{template "partials/base_head.html" .}}
{{template "partials/header.html" .}}

<main class="main">
    <div class="container">
        <h1>{{t "profile.title"}}</h1>
        <p>{{t "profile.welcome" .user.Name}}</p>
        
        <button>{{t "profile.edit"}}</button>
        <button>{{t "common.save"}}</button>
    </div>
</main>

{{template "partials/footer.html" .}}
{{template "partials/base_foot.html" .}}
{{end}}
```

## Устранение неполадок

### Переводы не загружаются

Проверьте что:
- Файлы переводов существуют в директории `locales/`
- Файлы являются валидным JSON
- Сервер имеет права на чтение
- Проверьте логи сервера на ошибки

### Отображается неправильный язык

Проверьте по порядку:
1. Параметр запроса: `?lang=ru`
2. Cookie: `locale=ru`
3. Заголовок Accept-Language
4. Локаль по умолчанию (английский)

### Отсутствующие переводы

- Проверьте консоль браузера на предупреждения
- Убедитесь что ключ перевода существует в JSON файле
- Проверьте опечатки в именах ключей
- Убедитесь что JSON файл правильно отформатирован

## Связанное

- [Примеры](EXAMPLES.ru.md)
- [Развертывание](DEPLOYMENT.ru.md)
