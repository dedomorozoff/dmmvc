# Internationalization (i18n)

DMMVC includes built-in support for internationalization, allowing your application to support multiple languages.

## Features

- Multiple language support (English, Russian)
- Automatic locale detection from:
  - Query parameters (`?lang=ru`)
  - Cookies
  - Accept-Language header
- Template integration
- API for locale switching
- Easy to add new languages

## Configuration

### Default Locale

Set the default locale in `.env` file:

```env
# Default locale (en, ru)
DEFAULT_LOCALE=en
```

If not specified, English (en) is used by default.

### Translation Files

Translation files are stored in the `locales/` directory as JSON files:

```
locales/
├── en.json  # English translations
└── ru.json  # Russian translations
```

### Translation File Format

```json
{
  "key": "Translation text",
  "greeting": "Hello, %s!",
  "app.name": "My Application"
}
```

## Usage

### In Go Handlers

```go
import "dmmvc/internal/i18n"

func MyHandler(c *gin.Context) {
    // Get translated string
    message := i18n.T(c, "greeting", "John")
    
    // Get current locale
    locale := i18n.GetLocale(c)
    
    c.JSON(200, gin.H{
        "message": message,
        "locale": locale,
    })
}
```

### In Templates

Templates automatically have access to translation functions:

```html
<h1>{{t "app.name"}}</h1>
<p>{{t "greeting" .username}}</p>
<p>Current language: {{locale}}</p>
```

### Changing Locale

#### Via Query Parameter

```
http://localhost:8080/?lang=ru
```

#### Via API

```javascript
fetch('/api/locale', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({ locale: 'ru' })
});
```

#### Via Language Switcher

The UI includes an automatic language switcher that appears in the header.

## API Endpoints

### Set Locale

**POST** `/api/locale`

Request:
```json
{
  "locale": "ru"
}
```

Response:
```json
{
  "success": true,
  "locale": "ru"
}
```

### Get Available Locales

**GET** `/api/locales`

Response:
```json
{
  "success": true,
  "data": {
    "locales": ["en", "ru"],
    "current": "en"
  }
}
```

## Adding New Languages

1. Create a new translation file in `locales/` directory:

```bash
# Create Spanish translations
touch locales/es.json
```

2. Add translations:

```json
{
  "app.name": "Mi Aplicación",
  "greeting": "¡Hola, %s!"
}
```

3. Update `internal/i18n/i18n.go` to include the new locale:

```go
const (
    LocaleEN Locale = "en"
    LocaleRU Locale = "ru"
    LocaleES Locale = "es"  // Add new locale
)
```

4. Update `LoadTranslations` method:

```go
locales := []Locale{LocaleEN, LocaleRU, LocaleES}
```

5. Update middleware and handlers to support the new locale.

## Best Practices

### Translation Keys

Use hierarchical keys for better organization:

```json
{
  "auth.login": "Login",
  "auth.logout": "Logout",
  "auth.register": "Register",
  "user.profile": "Profile",
  "user.settings": "Settings"
}
```

### Placeholders

Use `%s`, `%d`, etc. for dynamic values:

```json
{
  "welcome": "Welcome, %s!",
  "items_count": "You have %d items"
}
```

Usage:
```go
i18n.T(c, "welcome", username)
i18n.T(c, "items_count", count)
```

### Fallback

If a translation key is not found:
1. System tries the default locale (English)
2. If still not found, returns the key itself

### Performance

- Translations are loaded once at startup
- Cached in memory for fast access
- Thread-safe with RWMutex

## Example

### Controller

```go
func ProfilePage(c *gin.Context) {
    user := getCurrentUser(c)
    
    c.HTML(200, "pages/profile.html", gin.H{
        "title": i18n.T(c, "profile.title"),
        "user": user,
    })
}
```

### Template

```html
{{define "pages/profile.html"}}
{{template "partials/base_head.html" .}}
{{template "partials/header.html" .}}

<main class="main">
    <div class="container">
        <h1>{{t "profile.title"}}</h1>
        <p>{{t "profile.welcome" .user.Name}}</p>
        
        <button>{{t "profile.edit"}}</button>
        <button>{{t "common.save"}}</button>
    </div>
</main>

{{template "partials/footer.html" .}}
{{template "partials/base_foot.html" .}}
{{end}}
```

## Troubleshooting

### Translations Not Loading

Check that:
- Translation files exist in `locales/` directory
- Files are valid JSON
- Server has read permissions
- Check server logs for errors

### Wrong Language Displayed

Check in order:
1. Query parameter: `?lang=ru`
2. Cookie: `locale=ru`
3. Accept-Language header
4. Default locale (English)

### Missing Translations

- Check browser console for warnings
- Verify translation key exists in JSON file
- Check for typos in key names
- Ensure JSON file is properly formatted

## Related

- [Examples](EXAMPLES.md)
- [Deployment](DEPLOYMENT.md)
