# Архитектура DMMVC Framework

## Обзор архитектуры

DMMVC следует классическому паттерну MVC (Model-View-Controller) с дополнительными слоями для middleware и сервисов.

```
┌─────────────────────────────────────────────────────────────┐
│                         Browser                              │
└────────────────────────┬────────────────────────────────────┘
                         │ HTTP Request
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                      Gin Router                              │
│                    (routes/routes.go)                        │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                     Middleware Layer                         │
│  ┌──────────────┬──────────────┬──────────────────────┐    │
│  │   Logger     │     Auth     │   Custom Middleware  │    │
│  └──────────────┴──────────────┴──────────────────────┘    │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                     Controllers                              │
│  ┌──────────────┬──────────────┬──────────────────────┐    │
│  │     Auth     │     Home     │        User          │    │
│  └──────────────┴──────────────┴──────────────────────┘    │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
         ┌───────────────┴───────────────┐
         ▼                               ▼
┌─────────────────────┐         ┌─────────────────────┐
│      Models         │         │       Views         │
│  ┌──────────────┐   │         │  ┌──────────────┐   │
│  │     User     │   │         │  │   Templates  │   │
│  └──────────────┘   │         │  └──────────────┘   │
│         │           │         └─────────────────────┘
│         ▼           │
│  ┌──────────────┐   │
│  │   Database   │   │
│  │   (GORM)     │   │
│  └──────────────┘   │
47: └─────────────────────┘
```

## Структура директорий

```
dmmvc/
│
├── cmd/
│   └── server/
│       └── main.go                 # Точка входа приложения
│
├── internal/                       # Внутренний код приложения
│   │
│   ├── controllers/                # HTTP обработчики (Controller)
│   │   ├── auth_controller.go      # Аутентификация
│   │   ├── home_controller.go      # Главная страница
│   │   └── user_controller.go      # CRUD пользователей
│   │
│   ├── models/                     # Модели данных (Model)
│   │   └── user.go                 # Модель пользователя
│   │
│   ├── database/                   # Работа с БД
│   │   ├── db.go                   # Подключение к БД
│   │   └── seeder.go               # Начальные данные
│   │
│   ├── middleware/                 # Middleware слой
│   │   ├── auth.go                 # Проверка авторизации
│   │   └── logger.go               # Логирование запросов
│   │
│   ├── routes/                     # Маршрутизация
│   │   └── routes.go               # Определение маршрутов
│   │
│   └── logger/                     # Логирование
│       └── logger.go               # Настройка логгера
│
├── templates/                      # HTML шаблоны (View)
│   ├── layouts/
│   │   └── base.html               # Базовый layout
│   ├── partials/
│   │   ├── header.html             # Шапка сайта
│   │   └── footer.html             # Подвал сайта
│   └── pages/
│       ├── home.html               # Главная страница
│       ├── login.html              # Страница входа
│       ├── dashboard.html          # Dashboard
│       └── users/
│           ├── list.html           # Список пользователей
│           ├── create.html         # Создание пользователя
│           └── edit.html           # Редактирование
│
├── static/                         # Статические файлы
│   ├── css/
│   │   └── style.css               # Стили
│   └── js/
│       └── app.js                  # JavaScript
│
├── .env                            # Конфигурация
├── .env.example                    # Пример конфигурации
├── go.mod                          # Go модули
├── README.md                       # Документация
└── QUICKSTART.md                   # Быстрый старт
```

## Поток данных

### 1. Публичный запрос (например, главная страница)

```
Browser → Router → Middleware (Logger) → Controller (HomePage) → View (home.html) → Browser
```

### 2. Защищенный запрос (например, dashboard)

```
Browser → Router → Middleware (Logger, Auth) → Controller (DashboardPage) → View (dashboard.html) → Browser
```

### 3. CRUD операция (например, создание пользователя)

```
Browser → Router → Middleware (Logger, Auth) → Controller (UserStore) → Model (User) → Database → Redirect → Browser
```

## Компоненты

### Router (routes/routes.go)
- Определяет все маршруты приложения
- Группирует маршруты (публичные, защищенные, admin)
- Применяет middleware к группам маршрутов

### Middleware
- **Logger**: Логирует все HTTP запросы
- **Auth**: Проверяет авторизацию пользователя
- **Custom**: Можно добавить свои middleware

### Controllers
- Обрабатывают HTTP запросы
- Взаимодействуют с моделями
- Возвращают HTML или JSON ответы

### Models
- Определяют структуру данных
- Используют GORM для работы с БД
- Содержат бизнес-логику

### Views (Templates)
- **Layouts**: Базовая структура страниц
- **Partials**: Переиспользуемые компоненты
- **Pages**: Конкретные страницы

### Database
- Подключение к SQLite/MySQL
- Автоматические миграции
- Seeding начальных данных

## Принципы разработки

### 1. Separation of Concerns
Каждый компонент отвечает за свою задачу:
- Controllers - обработка запросов
- Models - работа с данными
- Views - отображение

### 2. DRY (Don't Repeat Yourself)
- Переиспользование layouts и partials
- Общие middleware для всех маршрутов
- Базовые модели с GORM

### 3. Convention over Configuration
- Стандартная структура директорий
- Именование по соглашению
- Минимум конфигурации

### 4. Security First
- Хеширование паролей (bcrypt)
- Защита сессий
- Middleware для авторизации

## Расширение фреймворка

### Добавление нового функционала

1. **Создать модель** в `internal/models/`
2. **Создать контроллер** в `internal/controllers/`
3. **Добавить маршруты** в `internal/routes/routes.go`
4. **Создать шаблоны** в `templates/pages/`
5. **Добавить стили** в `static/css/style.css`

### Добавление middleware

1. Создать файл в `internal/middleware/`
2. Реализовать `gin.HandlerFunc`
3. Применить в `routes.go`

### Добавление сервиса

1. Создать директорию `internal/services/`
2. Реализовать бизнес-логику
3. Использовать в контроллерах

---

Эта архитектура обеспечивает:
- Масштабируемость
- Поддерживаемость
- Тестируемость
- Безопасность
- Производительность
